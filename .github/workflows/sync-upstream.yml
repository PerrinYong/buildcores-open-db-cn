name: Sync Nested Upstream Submodule

on:
  workflow_dispatch:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

permissions:
  contents: read

jobs:
  validate-submodule:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          submodules: recursive

      - name: Ensure nested upstream submodule exists
        run: |
          test -f .gitmodules
          grep -q "submodule \"open-db-upstream\"" .gitmodules

      - name: Sync and update nested submodule
        run: |
          git submodule sync -- open-db-upstream
          git submodule update --init --recursive open-db-upstream

      - name: Verify expected upstream data path
        run: |
          test -d open-db-upstream/open-db
          echo "Nested upstream submodule is ready."
